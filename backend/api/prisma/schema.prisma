datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator js_client {
  provider = "prisma-client-js"
  output = "./client"
  engineType = "binary"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
  previewFeatures = ["fullTextSearch"]
}

generator py_client {
  provider = "prisma-client-py"
  interface = "asyncio"
  recursive_type_depth = 5
}


model User {
  id         Int     @id @default(autoincrement())
  name       String
  email      String  @unique
  profilePic String?
  fridges    UserFridge[] @@embedded
  feedbacks  Feedback[]
}

model Feedback {
  id       Int     @id @default(autoincrement())
  user     User    @relation(fields: [userId], references: [id])
  userId   Int
  recipe   Recipe  @relation(fields: [recipeId], references: [id])
  recipeId Int
  isChosen Boolean
  rating   Int
  notes    String?
}

model Recipe {
  id                Int                @id @default(autoincrement())
  title             String             @unique
  category          String
  imageUrl          String?
  recipeIngredients RecipeIngredient[] @@embedded
  steps             Step[] @@embedded
  feedbacks         Feedback[]
}

model Step {
  id         Int     @id @default(autoincrement())
  recipe     Recipe  @relation(fields: [recipeId], references: [id])
  recipeId   Int
  nStep      Int
  imageUrl   String?
  explaining String
}

model RecipeIngredient {
  id             Int        @id @default(autoincrement())
  recipe         Recipe     @relation(fields: [recipeId], references: [id])
  recipeId       Int
  ingredient     Ingredient @relation(fields: [ingredientId], references: [id])
  ingredientId   Int
  amountText     String
  amount         Float
  product        Product?   @relation(fields: [productBarcode], references: [barcode])
  productBarcode Int?
}

model Ingredient {
  id                Int                 @id @default(autoincrement())
  name              String              @unique
  unit              String?
  products          Product[]
  recipeIngredients RecipeIngredient[] @@embedded
}

model Product {
  barcode           Int                 @id @unique
  fridge            Fridge?             @relation(fields: [fridgeId], references: [id])
  fridgeId          Int?
  ingredient        Ingredient          @relation(fields: [ingredientId], references: [id])
  ingredientId      Int
  name              String
  brand             String
  labels            Boolean
  ecoScore          Int
  novaScore         Int
  bigImageUrl       String
  miniImageUrl      String
  meal              Boolean
  allergens         String
  quantity          Int
  fridges           FridgeProduct[] @@embedded
  recipeIngredients RecipeIngredient[] @@embedded
}

model Fridge {
  id       Int             @id @default(autoincrement())
  name     String          @unique
  products FridgeProduct[] @@embedded
  users    UserFridge[]
}

model UserFridge {
  id       Int     @id @default(autoincrement())
  user     User    @relation(fields: [userId], references: [id])
  userId   Int
  fridge   Fridge  @relation(fields: [fridgeId], references: [id])
  fridgeId Int
  isAdmin  Boolean
  isOwner  Boolean
}

model FridgeProduct {
  id             Int     @id @default(autoincrement())
  fridge         Fridge  @relation(fields: [fridgeId], references: [id])
  fridgeId       Int
  product        Product @relation(fields: [productBarcode], references: [barcode])
  productBarcode Int
  quantity       Int
}

model IngredientProduct {
  ingredient     Ingredient @relation(fields: [ingredientId], references: [id])
  ingredientId   Int
  product        Product    @relation(fields: [productBarcode], references: [barcode])
  productBarcode Int
  quantity       Int

  @@id([ingredientId, productBarcode])
}


